(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[535,650],{4850:function(e,a,t){Promise.resolve().then(t.bind(t,6371))},6371:function(e,a,t){"use strict";t.r(a);var i=t(7437),s=t(2265),l=t(4033);t(1396);var n=t(5391),r=t(2173);a.default=()=>{let[e,a]=(0,s.useState)({title:"",publishing_year:"",file:"",editFile:""}),t=(0,l.useParams)(),o=(0,l.useRouter)(),[c,d]=(0,s.useState)(!1),[u,p]=(0,s.useState)({}),m=async()=>{let e=localStorage.getItem("userData")?JSON.parse(localStorage.getItem("userData")):"";d(!0),r.Z.post("/api/movies/".concat(t.id),{},{headers:{Authorization:"Bearer ".concat(null==e?void 0:e.token)}}).then(function(e){void 0==e.data.title&&o.push("/movies"),d(!1),a({title:e.data.title,publishing_year:e.data.publishing_year,file:"",editFile:e.data.poster?e.data.poster:""})}).catch(function(e){401==e.response.status&&(localStorage.setItem("userData",""),o.push("/")),p({...u,common:e.response.data.error})})};(0,s.useEffect)(()=>{t.id&&m()},[]);let g=async e=>{e.preventDefault(),p({});let a=f();if(Object.keys(a).length)return p(a);d(!0),t.id?await x():await b()},h=t=>{a({...e,[t.target.name]:t.target.value})},f=()=>{let a={};return e.title||(a.title="Title is required"),e.publishing_year||(a.publishing_year="Publishing year is required"),e.file||e.editFile||(a.file="Image is required"),a},b=async()=>{let a=localStorage.getItem("userData")?JSON.parse(localStorage.getItem("userData")):"",t=new FormData;t.append("title",e.title),t.append("publishing_year",e.publishing_year),t.append("file",e.file),t.append("action","add"),r.Z.post("/api/movies",t,{headers:{Authorization:"Bearer ".concat(null==a?void 0:a.token)}}).then(function(e){o.push("/movies")}).catch(function(e){401==e.response.status&&(localStorage.setItem("userData",""),o.push("/")),d(!1),p({...u,common:e.response.data.error})})},x=async()=>{let a=localStorage.getItem("userData")?JSON.parse(localStorage.getItem("userData")):"",i=new FormData;i.append("title",e.title),i.append("publishing_year",e.publishing_year),i.append("file",e.file),r.Z.put("/api/movies/".concat(t.id),i,{headers:{Authorization:"Bearer ".concat(null==a?void 0:a.token)}}).then(function(e){o.push("/movies")}).catch(function(e){401==e.response.status&&(localStorage.setItem("userData",""),o.push("/")),d(!1),p({...u,common:e.response.data.error})})},y=()=>{let e=localStorage.getItem("userData")?JSON.parse(localStorage.getItem("userData")):"";e||o.push("/")};return(0,s.useEffect)(()=>{y()},[]),(0,i.jsxs)("div",{className:"container",children:[(0,i.jsx)("nav",{className:"py-5 mb-2",children:(0,i.jsx)("div",{className:"px-10 md:px-0 mx-auto flex justify-between",children:(0,i.jsx)("div",{children:(0,i.jsx)("span",{className:"text-5xl font-bold",children:t.id?"Edit":"Create a new movie "})})})}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-6",children:[(0,i.jsxs)("label",{htmlFor:"fileUpload",className:"DragImage",children:[""==e.file&&""==e.editFile&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.VxU,{className:"display-6 mb-3"}),(0,i.jsx)("span",{className:"display-8 fw-bold",children:"Drag an image here "})]}),""!=e.file&&(0,i.jsx)("img",{width:"90%",src:URL.createObjectURL(e.file)}),""==e.file&&""!=e.editFile&&(0,i.jsx)("img",{width:"90%",src:"http://localhost:3000/uploads/"+e.editFile})]}),(0,i.jsx)("span",{className:"text-danger fw-bold",children:u.file?u.file+".":""}),(0,i.jsx)("input",{type:"file",style:{display:"none"},placeholder:"file",name:"file",id:"fileUpload",accept:"image/png, image/gif, image/jpeg",onChange:t=>{console.log(t.target.files),a({...e,[t.target.name]:t.target.files[0]})},className:"bg-gray-800 border-2 w-full p-4 rounded-lg my-4"})]}),(0,i.jsxs)("div",{className:"col-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"text",placeholder:"Title",name:"title",onChange:h,value:e.title,autoFocus:!0,className:"bg-gray-800 border-2 w-full p-4 rounded-lg my-4 InputFieldStyle mb-1"}),(0,i.jsx)("span",{className:"text-danger fw-bold",children:u.title?u.title+".":""})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{name:"publishing_year",type:"number",placeholder:"Publishing year",onChange:h,value:e.publishing_year,className:"bg-gray-800 border-2 w-half p-4 d-block rounded-lg my-4 InputFieldStyle mb-1"}),(0,i.jsx)("span",{className:"text-danger fw-bold",children:u.publishing_year?u.publishing_year+".":""})]}),(0,i.jsx)("p",{children:u.common?u.common:""}),(0,i.jsxs)("div",{className:"mt-5 formSubmition",children:[(0,i.jsx)("i",{onClick:()=>o.push("/movies"),className:"createEditCancelBtn",children:"Cancel"}),!0==c?(0,i.jsx)("i",{variant:"success",size:"lg",className:"ml-3 createEditSubmitBtn",children:t.id?"Updating":"Submiting"}):(0,i.jsx)("i",{onClick:g,variant:"success",size:"lg",className:"ml-3 createEditSubmitBtn",children:t.id?"Update":"Submit"})]})]})]})]})}}},function(e){e.O(0,[929,630,524,971,596,744],function(){return e(e.s=4850)}),_N_E=e.O()}]);